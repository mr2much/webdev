<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Simple Game GUI</title>
    <!-- <link rel="stylesheet" href="./res/css/app.css" /> -->
    <link rel="stylesheet" href="./res/css/main.css" />
  </head>
  <body>
    <!-- <section id="char_gui">
      <h2>Young Knight</h2>
      <div class="details">
        <img src="./res/img/knight.jpeg" alt="The portrait of the character" />
        <div id="char_info">
          <div>
            <div class="hp_bar">
              <img
                src="./res/img/heart.jpeg"
                alt="Heart representing the life of the character"
              />
              15/15
            </div>
            <div class="equipment">
              <figure class="weapon">
                <figcaption>Weapon</figcaption>
                <img
                  src="./res/img/gauntlets.jpeg"
                  alt="The weapon equipped by the character"
                />
              </figure>
              <figure class="armor">
                <figcaption>Armor</figcaption>
                <img
                  src="./res/img/spiked_armor.png"
                  alt="The armor equipped by the character"
                />
              </figure>
              <figure class="shield">
                <figcaption>Shield</figcaption>
                <img
                  src="./res/img/shield.jpeg"
                  alt="The weapon equipped by the character"
                />
              </figure>
            </div>
          </div>
        </div>
      </div>
    </section> -->
    <!-- <char-gui></char-gui> -->
    <!-- 
    <div class="portrait">
      <img src="res/img/knight.jpeg" alt="" />
    </div> -->
    <!-- 
    <div class="health-bar">
      <div class="health-bar-value"></div>
      <div class="health-bar-fill"></div>
    </div> -->

    <button>click me</button>

    <style>
      .health-bar {
        position: relative;
        width: 100%;
        height: 40px;
        border: 1px solid black;
      }

      .health-bar-fill {
        --current-health: 65%;
        width: var(--current-health);
        height: 100%;
        background: linear-gradient(90deg, red, orange, yellow, green);
        background-size: 1000%;
        background-position: var(--current-health);
        transition: width 0.5s, background-position 0.5s;
      }

      .health-bar-value {
        position: absolute;
        width: 100%;
        height: 100%;

        display: flex;
        align-items: center;
        justify-content: center;

        font-weight: 900;
      }
    </style>

    <script>
      let sTemplate = (value) => `
        .health-bar {
          position: relative;
          width: 100%;
          height: 40px;
          border: 1px solid black;
        }

        .health-bar-fill {          
          width: ${value}%;
          height: 100%;
          background: linear-gradient(90deg, red, orange, yellow, green);
          background-size: 1000%;
          background-position: ${value}%;
          transition: width 0.75s, background-position 0.75s;
        }

        .health-bar-value {
          position: absolute;
          width: 100%;
          height: 100%;

          display: flex;
          align-items: center;
          justify-content: center;

          font-weight: 900;
        }
      `;

      class ProgressBar extends HTMLElement {
        constructor(initialValue = 0) {
          super();

          const style = document.createElement("style");
          style.textContent = sTemplate(initialValue);

          const healthBar = document.createElement("div");
          healthBar.classList.add("health-bar");

          const valueContainer = document.createElement("div");
          valueContainer.classList.add("health-bar-value");

          const fillContainer = document.createElement("div");
          fillContainer.classList.add("health-bar-fill");

          this.styleElement = style;
          this.valueElement = valueContainer;
          this.fillElement = fillContainer;

          const shadow = this.attachShadow({ mode: "open" });

          this.setValue(initialValue);

          healthBar.appendChild(valueContainer);
          healthBar.appendChild(fillContainer);
          shadow.appendChild(healthBar);
          shadow.appendChild(style);
        }

        setValue(newValue) {
          console.log("Setting value to:", newValue);
          if (newValue < 0) {
            newValue = 0;
          }

          if (newValue > 100) {
            newValue = 100;
          }

          this.value = newValue;
          this.update();
        }

        update() {
          this.styleElement.textContent = sTemplate(this.value);
          this.valueElement.textContent = `${this.value}%`;
        }
      }

      customElements.define("progress-bar", ProgressBar);

      const button = document.querySelector("button");

      let pb1 = new ProgressBar(100);

      document.body.appendChild(pb1);

      button.addEventListener("click", () => {
        console.log("Clicked");
        let val = pb1.value - 5;
        pb1.setValue(val);
      });
    </script>

    <script src="./js/knight.js"></script>
    <script src="./js/hp_bar.js"></script>
    <script src="./js/char_avatar.js"></script>
    <script src="./js/char_gui.js"></script>
    <script src="./js/app.js"></script>
  </body>
</html>
